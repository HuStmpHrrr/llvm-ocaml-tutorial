(library
 (name kaleidoscope_lib)
 (libraries 
   angstrom
   async
   core
   ctypes.foreign
   llvm
   llvm.analysis
   llvm.executionengine
   llvm.target
   llvm.scalar_opts)
 (preprocess (pps ppx_jane ppx_expect ppx_let))
 (inline_tests))

(rule
 (targets ocamllexer.ml)
  (deps ocamllexer.mll)
  (action (run %{bin:ocamllex} -q -o %{targets} %{deps})))

(rule 
 (targets menhir_parser.mli menhir_parser.ml)
  (deps menhir_parser.mly)
  (action (ignore-stderr (run menhir --external-tokens Ast --explain %{deps}))))
